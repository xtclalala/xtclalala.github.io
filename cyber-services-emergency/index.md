# 应急响应-从理论到实战


## 第一章：了解应急响应

<br>
网络安全是指网络系统的硬件、软件及其系统中的数据受到保护，不因偶发的或恶意的原因而遭到破坏、更改、泄露，保证系统连接的可靠性、稳定性。面对各种新奇怪异的病毒和不计其数的安全漏洞，建立有效的安全应急体系并使之不断完善，已成为信息化社会发展的必然需求。

<br>

网络安全应急响应是指针对已发生或可能发生的安全事件进行监控、分析、协调、处理、保护资产安全。网络安全应急响应主要目的是让群众对网络安全有所认识和准备，以便在遇到突发网络安全事件时做到有序应对和妥善处理。
***
<br>

## 第二章：应急响应流程
<br>

### 一、响应
##### 对事件进行判断
常见网络安全应急响应场景：勒索病毒、挖矿木马、WebShell、网页篡改、Dos攻击、数据泄露、流量劫持

<br>

##### 信息收集
信息收集的目的：流量分析、日志分析、可疑进程的内存、失陷系统镜像、恶意样本、资产收集、资产相关漏洞测试报告、防护设备日志。

<br>

### 二、阻断
> 所谓阻断即为：关闭服务、拔网线
##### 切断网络
切断网络是为观察病毒行为、观察流量特征、阻断对内通信、阻断对外连接。

<br>

##### 阻断传播
> 传播包括：感染（对内传播），外联（对外传播）
- 感染：进程注入/迁移，第三方软件感染，服务传播（ftp/ssh爆破等）
- 外联：挖矿行为、外联攻击、c2通信

阻断传播可以从代码、网络层面进行。
> 例：排查软件是否被劫持、查找内存马、是否通过网络传播病毒。

<br>

##### 隔离核心资产/隔离受害主体（群体）
不论任何情况必须保证沦陷方的隔离，达到保护现场、收集攻击者信息，原则为：保护、弊害、不损害。

<br>

### 三、分析
> 分析的前提是提炼，提炼出关键信息分析，而提炼的前提是熟悉攻击手法。

<br>

##### 日志、流量、样本
- 日志主要注意内容为时间、动作、结果；威胁行为的开始时间、结束时间，威胁行为具体的功能、造成的结果等。
- 流量主要注意内容为请求状态码、交互过程、数据合理性；接口中数据的传输是否符合正常使用数据。
- 样本主要注意内容为样本的启动方式、伪装方式、作用。

<br>

##### 行为分析&还原攻击过程
> 从行为出发，还原攻击过程，推演攻击过程。

行为分析主要依据：启动项、启动脚本、进程、内存等。

<br>

### 响应基本命令
#### 系统排查
##### win
- 服务、驱动：msinfo32
- 系统版本/主机名：systeminfo
##### linux
- cpu信息：lscpu
- 操作系统信息：uname -a
- 操作系统版本信息：cat /proc/version
- 所有载入系统的模块信息：lsmod

<br>

#### 启动项
##### win
- 启动项详细信息：msconfig
##### linux
- 启动项脚本文件存放处：ls -alt /etc/init.d
- 存放启动项脚本存储路径的文件：cat /etc/rc.local

<br>

#### 任务计划
##### win
- 在powershell中查看系统所有任务计划信息： Get-ScheduledTask
- 查看任务计划信息：schtasks
##### linux
- 查看当前计划任务：crontab -l
- 查看etc目录下所有的任务计划文件：ls /etc/cron*

<br>

#### 防火墙
##### win
- 防火墙信息查看：netsh advfirewall firewall show rule
##### linux
- 查看路由转换：iptables -L

<br>

#### 系统进程
##### win
- 所有进程，查询加载恶意dll的进程：tasklist /m
- 查看指定网络连接：netstat -ano | findstr "内容名称"
##### linux
- 查看cpu占用高的进程：top
- 查看指定pid执行程序：ls -alt /proc/pid
- 结束进程： kill -9 pid

<br>

#### 文件痕迹排查
##### win
- 检查浏览器、下载文件、cookie信息
##### linux
- 查找当天新增sh文件：find / -ctime 0 -name "*.sh"

<br>

#### 日志排查
##### win
- 在事件查看器中找事件id为4625（登陆错误）、4720（创建用户）、1102（清理审计日志）
##### linux
- 常规日志文件存在在：/var/log

<br>

#### 排查WebShell
##### linux
- 根据webshell特征对文件进行排查
    - find / -type f -name "*.jsp" | xargs grep "exec("
    - find / -type f -name "*.php" | xargs grep "eval("
    - find / -type f -name "*.asp" | xargs grep "execute("
    - find / -type f -name "*.aspx" | xargs grep "eval("
